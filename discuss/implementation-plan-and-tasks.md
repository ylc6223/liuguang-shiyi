# 实施计划与任务清单（V1）

本文用于评审与协作拆解，按里程碑组织。默认使用数字枚举约束模型与前端常量，遵循每文件 ≤ 300 行、每层目录 ≤ 8 文件的约束。

## 里程碑
- M1（2 周）：信息架构、样板 CRUD、首发能力
  - 目标：前后台可构建运行；模型（事件/人物/朝代/标签/媒体/合集）完成样板 CRUD；首页/时间线/详情可用；登录与路由守卫。
- M2（2 周）：工作流与检索
  - 目标：草稿→审核→发布全链路；筛选/搜索；基础权限与审计。
- M3（1–2 周）：体验与性能
  - 目标：移动端适配细化、时间线可视化优化、专题合集页、观测与埋点。

## 任务清单（按应用）

### apps/admin-umi（CMS 后台）
- 基建与样板
  - [ ] 完成鉴权守卫：登录后持久化 token，未登录跳转登录页；基于 `UserRole` 控制菜单（隐藏/禁用）。
  - [ ] 仪表盘指标：草稿数/待审/已发布、最近编辑列表（使用 Mock API）。
  - [ ] 列表页样板（事件/人物/朝代/标签/媒体/合集）：分页、状态筛选（`ReviewStatus`/`Visibility`）。
  - [ ] 编辑页样板：表单（zod + RHF）+ 上传（`MediaType`）+ 关联选择（人物/标签/朝代）。
  - [ ] 发布流：草稿保存、提交审核、发布/下线；按钮按 `UserRole`/`ReviewStatus` 控制。
- 质量与体验
  - [ ] Loading/Empty/Error 三态；表单字段校验与错误提示统一。
  - [ ] Storybook 覆盖关键表单控件与卡片组件。
  - [ ] Vitest 针对表单校验与轻逻辑（选择器/格式化）。

### apps/web-guofeng（前台站点）
- 页面与路由
  - [ ] 首页：精选 `Collection`、最近更新（`Event`）、时间线预览。
  - [ ] 时间线页：按 `Dynasty`/世纪分段，支持 `EventCategory` 筛选。
  - [ ] 详情页：事件/人物；关联跳转（人物 ↔ 事件 ↔ 朝代 ↔ 集合）。
  - [ ] 列表与检索：关键字 + 多条件筛选；分页。
- 性能与 SEO
  - [ ] SSG/ISR 策略与缓存键；next/image 占位与懒加载；基础 meta/OG；站点地图（后置）。
- 测试
  - [ ] Playwright：首页/时间线/详情加载；关键交互通过（使用 Mock）。

### packages/ui / tailwind-config
- 设计系统
  - [ ] 国风主题 tokens（色板/字体/阴影/边框）与文档。
  - [ ] 复用的“画像卡片”、“时间线项”、“统计卡片”、“筛选条”等复合组件。
  - [ ] Storybook 示例与 A11y 检查。

## 接口与 Mock 任务
- [ ] 约定 REST 路由（见 docs/tech-spec-guofeng-cms.md），在 `apps/web-guofeng` 建立 `/api/*` Mock（或使用 MSW）。
- [ ] 统一错误码 `ErrorCode`，前端封装请求器（拦截器、错误提示策略）。

## 测试与验收
- 单测（Vitest）
  - [ ] zod 校验与工具函数；组件交互快照谨慎使用。
- 集成/E2E（Playwright）
  - [ ] 后台登录 → 创建草稿 → 提交审核 → 发布 → 前台可见。
- 覆盖指标
  - [ ] 关键路径覆盖 ≥ 70%；可视为通过门槛。

## 风险与对策
- 时间线可视化的性能：优先按分段/分页/虚拟化处理，再评估专用可视化库。
- 内容规模增长的检索：阶段性引入全文检索（如外部服务/索引）；保持接口与查询层解耦。
- 图片与版权：统一上传类型校验与压缩处理，考虑接入 CDN。

## 待确认（Open Questions）
- 是否需要细化到年-月-日级别的时间轴与模糊时间范围？
- 是否需要机构/地理实体（州郡/城池）模型以增强关联？
- 是否需要国际化与多语内容？优先级与里程碑？

